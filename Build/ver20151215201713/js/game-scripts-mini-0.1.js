(function(e,t,n){qc.landlord={},e.G=qc.landlord.G={},qc.initGame=function(e){e.log.trace("Start the game landlord."),G.game=e,G.cardMgr=new qc.landlord.Card,G.ownPlayer=new qc.landlord.Player("QCPlayer"),G.ownPlayer.isAI=!1;var t=e.storage,n=t.get("QCPlayer");G.ownPlayer.score=n?n:500,G.leftPlayer=new qc.landlord.Player("AI_Left");var r=t.get("AI_Left");G.leftPlayer.score=r?r:500,G.rightPlayer=new qc.landlord.Player("AI_Right");var i=t.get("AI_Right");G.rightPlayer.score=i?i:500,G.ownPlayer.nextPlayer=G.rightPlayer,G.rightPlayer.nextPlayer=G.leftPlayer,G.leftPlayer.nextPlayer=G.ownPlayer,G.hiddenCards=[],G.currentCards=[],G.gameRule=new qc.landlord.GameRule};var r=qc.defineBehaviour("qc.engine.PlayUI",qc.Behaviour,function(){this.startBtn=null,this.currentScore=0,this.round=0,this.currentLandlord=null,e.playUI=this},{startBtn:qc.Serializer.NODE,ownCardContainer:qc.Serializer.NODE,hiddenContainer:qc.Serializer.NODE,cardPrefab:qc.Serializer.PREFAB,msgPrefab:qc.Serializer.PREFAB,scoreOne:qc.Serializer.NODE,scoreTwo:qc.Serializer.NODE,scoreThree:qc.Serializer.NODE,scoreZero:qc.Serializer.NODE,scorePanel:qc.Serializer.NODE,ratePanel:qc.Serializer.NODE,leftPlayerArea:qc.Serializer.NODE,rightPlayerArea:qc.Serializer.NODE,ownPlayerArea:qc.Serializer.NODE});r.prototype.awake=function(){var e=this;e.leftPlayerArea.getScript("qc.engine.PlayerUI").player=G.leftPlayer,e.rightPlayerArea.getScript("qc.engine.PlayerUI").player=G.rightPlayer,e.ownPlayerArea.getScript("qc.engine.PlayerUI").player=G.ownPlayer,e.reDrawScore(),e.addListener(e.startBtn.onClick,e.startGame,e),e.addListener(e.scoreOne.onClick,function(){e.playerProvideScore(1)},e),e.addListener(e.scoreTwo.onClick,function(){e.playerProvideScore(2)},e),e.addListener(e.scoreThree.onClick,function(){e.playerProvideScore(3)},e),e.addListener(e.scoreZero.onClick,function(){e.playerProvideScore(4)},e)},r.prototype.startGame=function(){var t=this;for(var n=0;n<G.currentCards.length;n++)G.currentCards[n].destroy();G.currentCards=[],G.hiddenCards=[],G.ownPlayer.cardList=[],G.leftPlayer.cardList=[],G.rightPlayer.cardList=[],t.currentScore=0,t.round=0,t.currentLandlord=null,t.scorePanel.text="0",t.ratePanel.text="1",t.ownPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!1,t.leftPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!1,t.rightPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!1,t.reDraw(),t.startBtn.visible=!1,e.landlordUI.roundWinner=null,e.landlordUI.hideBtn(),e.landlordUI.cleanAllPlayArea(),e.landlordUI.cue.visible=!1;for(n=0;n<t.hiddenContainer.children.length;n++)t.hiddenContainer.children[n].frame="bg.jpg";t.dealCards()},r.prototype.robLandlord=function(){var e=this,t=G.gameRule.random(1,3),n=t===1?G.ownPlayer:t==2?G.rightPlayer:G.leftPlayer;e.provideScore(n)},r.prototype.provideScore=function(t){var n=this;t.isAI?(n.scoreThree.visible=!1,n.scoreTwo.visible=!1,n.scoreOne.visible=!1,n.scoreZero.visible=!1,n.game.timer.add(1e3,function(){var r=(new p(t)).judgeScore(),i=t.nextPlayer.isAI?e.landlordUI.rightCards:e.landlordUI.leftCards;if(r<4&&r>n.currentScore){console.info(t.name+":叫"+r),n.currentScore=r,n.scorePanel.text=r+"",n.currentLandlord=t;for(var s=0;s<i.children.length;s++)i.children[s].destroy();var o=n.game.add.clone(n.msgPrefab,i);o.text=r+"分";if(r===3){n.setLandlord(t);return}}else{var o=n.game.add.clone(n.msgPrefab,i);o.text="不叫",console.info(t.name+"没有叫分抢地主")}++n.round===3?n.currentLandlord?n.setLandlord(n.currentLandlord):(n.showRestartMesg(),n.startGame()):n.provideScore(t.nextPlayer)})):(n.scoreZero.visible=!0,n.scoreThree.visible=!0,n.currentScore<2&&(n.scoreTwo.visible=!0),n.currentScore<1&&(n.scoreOne.visible=!0))},r.prototype.playerProvideScore=function(t){var n=this;if(t<4){n.currentScore=t,n.scorePanel.text=t+"",n.currentLandlord=G.ownPlayer;var r=n.game.add.clone(n.msgPrefab,e.landlordUI.ownCards);r.text=t+"分";if(t===3){n.setLandlord(G.ownPlayer);return}}else{var r=n.game.add.clone(n.msgPrefab,e.landlordUI.ownCards);r.text="不叫"}++n.round===3?n.currentLandlord?n.setLandlord(n.currentLandlord):(n.showRestartMesg(),n.startGame()):n.provideScore(G.ownPlayer.nextPlayer)},r.prototype.dealCards=function(){var e=this,t=G.cardMgr.getNewCards();for(var n=0;n<3;n++)G.hiddenCards.push(e.getOneCard(t));var r=17,i=function(){card=e.getOneCard(t),G.leftPlayer.cardList.push(card);var s=e.game.add.clone(e.cardPrefab,e.leftPlayerArea.getScript("qc.engine.PlayerUI").cardContainer);s.visible=!0,s.interactive=!1,card=e.getOneCard(t),G.rightPlayer.cardList.push(card),s=e.game.add.clone(e.cardPrefab,e.rightPlayerArea.getScript("qc.engine.PlayerUI").cardContainer),s.visible=!0,s.interactive=!1,s.name=card.icon.split(".")[0],card=e.getOneCard(t),G.ownPlayer.cardList.push(card),e.insertOneCard(card);if(--r>0)e.game.timer.add(200,i);else{G.leftPlayer.cardList.sort(e.cardSort),G.rightPlayer.cardList.sort(e.cardSort),G.ownPlayer.cardList.sort(e.cardSort);for(n=0;n<G.currentCards.length;n++)G.currentCards[n].getScript("qc.engine.CardUI").isSelected=!1;e.robLandlord()}};i()},r.prototype.getOneCard=function(e){var t=this;return e.splice(t.game.math.random(0,e.length-1),1)[0]},r.prototype.cardSort=function(e,t){var n=parseInt(e.val),r=parseInt(t.val);return n===r?e.type>t.type?1:-1:n>r?-1:1},r.prototype.setLandlord=function(t){var n=this;n.scorePanel.text=n.currentScore+"",n.scoreThree.visible=!1,n.scoreTwo.visible=!1,n.scoreOne.visible=!1,n.scoreZero.visible=!1;var r=n.hiddenContainer.children;for(var i=0;i<n.hiddenContainer.children.length;i++)n.hiddenContainer.children[i].frame=G.hiddenCards[i].icon;G.ownPlayer.isLandlord=!1,G.leftPlayer.isLandlord=!1,G.rightPlayer.isLandlord=!1,t.isLandlord=!0,n.setAIStation(n.leftPlayerArea,G.leftPlayer.isLandlord),n.setAIStation(n.rightPlayerArea,G.rightPlayer.isLandlord),n.ownPlayerArea.getScript("qc.engine.PlayerUI").headPic.frame=G.ownPlayer.isLandlord?"landlord.jpg":"peasant.jpg",n.ownPlayerArea.getScript("qc.engine.PlayerUI").headPic.visible=!0,t.cardList=t.cardList.concat(G.hiddenCards),t.cardList.sort(n.cardSort),n.reDraw();if(!t.isAI)for(i=0;i<G.hiddenCards.length;i++)n.insertOneCard(G.hiddenCards[i]);for(i=0;i<G.currentCards.length;i++)G.currentCards[i].getScript("qc.engine.CardUI").isSelected=!1;console.info("本轮地主是"+t.name),e.landlordUI.cleanAllPlayArea(),e.landlordUI.playCard(t)},r.prototype.insertOneCard=function(e){var t=this,n=0;if(G.currentCards.length!=0&&t.cardSort(e,G.currentCards[0])===1)for(var r=0;r<G.currentCards.length;r++){var i=G.currentCards[r].getScript("qc.engine.CardUI").info,s=null;r<G.currentCards.length-1&&(s=G.currentCards[r+1].getScript("qc.engine.CardUI").info);if(t.cardSort(e,i)===1&&(s&&t.cardSort(e,s)===-1||!s)){n=r+1;break}}var o=t.game.add.clone(t.cardPrefab,t.ownCardContainer);o.getScript("qc.engine.CardUI").show(e,!0),t.ownCardContainer.setChildIndex(o,n),G.currentCards.splice(n,0,o)},r.prototype.setAIStation=function(e,t){var n=e.getScript("qc.engine.PlayerUI");n.headPic.frame=t?"landlord.jpg":"peasant.jpg",n.headPic.visible=!0},r.prototype.reDraw=function(){var e=this,t=function(t,n){var r=t.children.length-n;if(r>0)for(var i=0;i<r;i++)t.removeChild(t.children[0]);else{r=-r;for(var i=0;i<r;i++){var s=e.game.add.clone(e.cardPrefab,t);s.visible=!0,s.interactive=!1}}};t(e.leftPlayerArea.getScript("qc.engine.PlayerUI").cardContainer,G.leftPlayer.cardList.length),t(e.rightPlayerArea.getScript("qc.engine.PlayerUI").cardContainer,G.rightPlayer.cardList.length)},r.prototype.reDrawScore=function(){var e=this,t=e.ownPlayerArea.getScript("qc.engine.PlayerUI"),n=e.leftPlayerArea.getScript("qc.engine.PlayerUI"),r=e.rightPlayerArea.getScript("qc.engine.PlayerUI");t.playerScore.text=t.player.score+"分",n.playerScore.text=n.player.score+"分",r.playerScore.text=r.player.score+"分"},r.prototype.showAICards=function(){var e=this,t=e.leftPlayerArea.getScript("qc.engine.PlayerUI").cardContainer,n=e.rightPlayerArea.getScript("qc.engine.PlayerUI").cardContainer;for(var r=0;r<t.children.length;r++)t.children[r].frame=G.leftPlayer.cardList[r].icon;for(r=0;r<n.children.length;r++)n.children[r].frame=G.rightPlayer.cardList[r].icon},r.prototype.showRestartMesg=function(){var t=this,n=e.landlordUI.cue;n.text=G.gameRule.MSG_NO_ROROB_RESTART,n.visible=!0,t.game.timer.add(1500,function(){n.visible=!1})};var s=qc.defineBehaviour("qc.engine.PlayerUI",qc.Behaviour,function(){this.player=null},{headPic:qc.Serializer.NODE,playerScore:qc.Serializer.NODE,cardContainer:qc.Serializer.NODE}),o=qc.defineBehaviour("qc.engine.LandlordUI",qc.Behaviour,function(){this.readyCards=[],this.noCardBtn=null,this.playBtn=null,this.winCard=null,this.roundWinner=null,e.landlordUI=this},{noCardBtn:qc.Serializer.NODE,cue:qc.Serializer.NODE,playBtn:qc.Serializer.NODE,warnBtn:qc.Serializer.NODE,ownCards:qc.Serializer.NODE,leftCards:qc.Serializer.NODE,rightCards:qc.Serializer.NODE,msgPrefab:qc.Serializer.PREFAB,cardPrefab:qc.Serializer.PREFAB});o.prototype.awake=function(){var t=this;this.addListener(t.playBtn.onClick,function(){var n=t.getReadyCardsKind();if(n){if(n.cardKind===G.gameRule.BOMB||n.cardKind===G.gameRule.KING_BOMB){var r=parseInt(e.playUI.ratePanel.text);e.playUI.ratePanel.text=r*2+""}t.winCard=n,t.roundWinner=G.ownPlayer,t.addOwnCards(),t.hideBtn();if(G.ownPlayer.cardList.length===0){t.judgeWinner(G.ownPlayer);return}t.playCard(G.ownPlayer.nextPlayer)}},this),this.addListener(t.warnBtn.onClick,function(){var e=new qc.landlord.AILogic(G.ownPlayer),n=null;!t.roundWinner||t.roundWinner.name==G.ownPlayer.name?(t.cleanAllPlayArea(),n=e.play()):n=e.follow();if(n){for(var r=0;r<G.currentCards.length;r++)G.currentCards[r].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[r].anchoredY=0,G.currentCards[r].getScript("qc.engine.CardUI").isSelected=!1);for(r=0;r<n.cardList.length;r++)for(var i=0;i<G.currentCards.length;i++){var s=G.currentCards[i].getScript("qc.engine.CardUI");if(n.cardList[r].val===s.info.val&&n.cardList[r].type===s.info.type){G.currentCards[i].anchoredY=-28,s.isSelected=!0;break}}t.getReadyCardsKind()?t.playBtn.state=qc.UIState.NORMAL:t.playBtn.state=qc.UIState.DISABLED}}),this.addListener(t.noCardBtn.onClick,function(){t.hideBtn();for(var e=0;e<G.currentCards.length;e++)G.currentCards[e].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[e].anchoredY=0,G.currentCards[e].getScript("qc.engine.CardUI").isSelected=!1);t.cue.visible=!1,t.game.add.clone(t.msgPrefab,t.ownCards),t.playCard(G.ownPlayer.nextPlayer)},this)},o.prototype.getReadyCardsKind=function(){var e=this;e.readyCards=[];for(i=0;i<G.currentCards.length;i++)G.currentCards[i].getScript("qc.engine.CardUI").isSelected&&e.readyCards.push(G.currentCards[i].getScript("qc.engine.CardUI").info);if(e.readyCards.length===0)return null;var t=G.gameRule.typeJudge(e.readyCards);return t?e.roundWinner&&e.roundWinner.name!=G.ownPlayer.name?function(e,n){return n.cardKind===G.gameRule.KING_BOMB||n.cardKind===G.gameRule.BOMB&&e.cardKind!=G.gameRule.BOMB||n.cardKind===e.cardKind&&n.size===e.size&&n.val>e.val?t:null}(e.winCard,t):t:null},o.prototype.addOwnCards=function(){var e=this,t=[];e.cleanPlayArea();for(i=G.currentCards.length-1;i>=0;i--)G.currentCards[i].getScript("qc.engine.CardUI").isSelected&&(G.currentCards[i].parent=e.ownCards,G.currentCards[i].interactive=!1,e.ownCards.setChildIndex(G.currentCards[i],0),G.currentCards.splice(i,1),G.ownPlayer.cardList.splice(i,1))},o.prototype.cleanPlayArea=function(){var e=this.ownCards.children;for(var t=0;t<e.length;t++)e[t].destroy()},o.prototype.cleanAllPlayArea=function(){this.cleanPlayArea();var e=this.leftCards.children,t=this.rightCards.children;for(var n=0;n<e.length;n++)e[n].destroy();for(n=0;n<t.length;n++)t[n].destroy()},o.prototype.playCard=function(t){var n=this;if(t.isAI){console.info(t.name+"出牌中");var r=new qc.landlord.AILogic(t),i=t.nextPlayer.isAI?n.rightCards:n.leftCards;for(var s=0;s<i.children.length;s++)i.children[s].destroy();n.game.timer.add(1e3,function(){var o=null;!n.roundWinner||n.roundWinner.name==t.name?(n.cleanAllPlayArea(),o=r.play()):o=r.follow();if(o){for(s=0;s<o.cardList.length;s++){var u=n.game.add.clone(n.cardPrefab,i);u.getScript("qc.engine.CardUI").show(o.cardList[s],!1),u.interactive=!1;for(var a=0;a<t.cardList.length;a++)if(t.cardList[a].val===o.cardList[s].val&&t.cardList[a].type===o.cardList[s].type){t.cardList.splice(a,1);break}}if(o.cardKind===G.gameRule.BOMB||o.cardKind===G.gameRule.KING_BOMB){var f=parseInt(e.playUI.ratePanel.text);e.playUI.ratePanel.text=f*2+""}n.roundWinner=t,delete o.cardList,n.winCard=o,e.playUI.reDraw()}else n.game.add.clone(n.msgPrefab,i);if(t.cardList.length===0){n.judgeWinner(t);return}n.playCard(t.nextPlayer)})}else console.info("该你出了"),n.getReadyCardsKind()?n.playBtn.state=qc.UIState.NORMAL:n.playBtn.state=qc.UIState.DISABLED,n.playBtn.visible=!0,n.warnBtn.visible=!0,n.cleanPlayArea(),!!n.roundWinner&&n.roundWinner.name!=t.name&&(n.noCardBtn.visible=!0)},o.prototype.hideBtn=function(){this.noCardBtn.visible=!1,this.playBtn.visible=!1,this.warnBtn.visible=!1},o.prototype.judgeWinner=function(t){var n=this;n.hideBtn();var r=parseInt(e.playUI.scorePanel.text)*parseInt(e.playUI.ratePanel.text);!t.isAI||!t.isLandlord&&!G.ownPlayer.isLandlord?(n.cue.text="你赢了",G.ownPlayer.isLandlord?(G.ownPlayer.score=G.ownPlayer.score+r*2,G.leftPlayer.score=G.leftPlayer.score-r,G.rightPlayer.score=G.rightPlayer.score-r):t.name==G.ownPlayer.name?(G.ownPlayer.score=G.ownPlayer.score+r,G.leftPlayer.isLandlord?(G.leftPlayer.score=G.leftPlayer.score-r*2,G.rightPlayer.score=G.rightPlayer.score+r):(G.leftPlayer.score=G.leftPlayer.score+r,G.rightPlayer.score=G.rightPlayer.score-r*2)):(G.ownPlayer.score=G.ownPlayer.score+r,t.score=t.score+r,G.playUI.currentLandlord.score=G.playUI.currentLandlord.score-2*r)):(n.cue.text="你输了",G.ownPlayer.isLandlord?(G.ownPlayer.score=G.ownPlayer.score-r*2,G.leftPlayer.score=G.leftPlayer.score+r,G.rightPlayer.score=G.rightPlayer.score+r):(G.ownPlayer.score=G.ownPlayer.score-r,G.leftPlayer.name===t.name?(G.leftPlayer.score=G.leftPlayer.score+r*2,G.rightPlayer.score=G.rightPlayer.score-r):(G.leftPlayer.score=G.leftPlayer.score-r,G.rightPlayer.score=G.rightPlayer.score+r*2))),e.playUI.reDrawScore(),n.cue.visible=!0,e.playUI.showAICards(),e.playUI.startBtn.visible=!0};var u=qc.defineBehaviour("qc.engine.CardUI",qc.Behaviour,function(){this.isSelected=!1,this.info=null},{});u.prototype.show=function(e,t){var n=this,r=n.gameObject;r.frame=e.icon,r.resetNativeSize(),r.visible=!0,n.info=e},u.prototype.onClick=function(){var t=this;t.isSelected?this.gameObject.anchoredY=0:this.gameObject.anchoredY=-28,t.isSelected=!t.isSelected;var n=e.landlordUI;n.getReadyCardsKind()?n.playBtn.state=qc.UIState.NORMAL:n.playBtn.state=qc.UIState.DISABLED};var a=qc.defineBehaviour("qc.engine.CardlistUI",qc.Behaviour,function(){},{});a.prototype.onDragStart=function(e){this.startX=this.gameObject.toLocal(new qc.Point(e.source.startX,e.source.startY)).x},a.prototype.onDrag=function(e){},a.prototype.onDragEnd=function(e){var t=this,n=this.gameObject.toLocal(new qc.Point(e.source.x,e.source.y)).x;if(n<t.startX){var r=n;n=t.startX,t.startX=r}for(var i=0;i<this.gameObject.children.length;i++){var s=this.gameObject.children[i],o=s.x,u=t.floatAdd(o,30),a=t.floatSub(t.startX,o),f=t.floatSub(u,n);(t.startX<o&&n>u||a<30&&a>=0||f<30&&f>=0)&&s.getScript("qc.engine.CardUI").onClick()}},a.prototype.floatAdd=function(e,t){var n,r,i;try{n=e.toString().split(".")[1].length}catch(s){n=0}try{r=t.toString().split(".")[1].length}catch(s){r=0}return i=Math.pow(10,Math.max(n,r)),(e*i+t*i)/i},a.prototype.floatSub=function(e,t){var n,r,i,s;try{n=e.toString().split(".")[1].length}catch(o){n=0}try{r=t.toString().split(".")[1].length}catch(o){r=0}return i=Math.pow(10,Math.max(n,r)),s=n>=r?n:r,((e*i-t*i)/i).toFixed(s)};var f=qc.landlord.Player=function(e){var t=this;t.name=e?e:"Player",t.isLandlord=!1,t.isAI=!0,t.cardList=[],t.nextPlayer=null};t.defineProperties(f.prototype,{score:{get:function(){return console.info(this.name,"分数：",this._score),this._score},set:function(e){this._score=e;var t=G.game.storage;t.set(this.name,e),t.save()}}});var l=qc.landlord.GameRule=function(){};l.prototype.typeJudge=function(e){var t=this,n=e.length;switch(n){case 1:return{cardKind:t.ONE,val:e[0].val,size:n};case 2:return t.isPairs(e)?{cardKind:t.PAIRS,val:e[0].val,size:n}:t.isKingBomb(e)?{cardKind:t.KING_BOMB,val:e[0].val,size:n}:null;case 3:return t.isThree(e)?{cardKind:t.THREE,val:e[0].val,size:n}:null;case 4:if(t.isThreeWithOne(e))return{cardKind:t.THREE_WITH_ONE,val:t.getMaxVal(e,3),size:n};if(t.isBomb(e))return{cardKind:t.BOMB,val:e[0].val,size:n};return null;default:return t.isProgression(e)?{cardKind:t.PROGRESSION,val:e[0].val,size:n}:t.isProgressionPairs(e)?{cardKind:t.PROGRESSION_PAIRS,val:e[0].val,size:n}:t.isThreeWithPairs(e)?{cardKind:t.THREE_WITH_PAIRS,val:t.getMaxVal(e,3),size:n}:t.isPlane(e)?{cardKind:t.PLANE,val:t.getMaxVal(e,3),size:n}:t.isPlaneWithOne(e)?{cardKind:t.PLANE_WITH_ONE,val:t.getMaxVal(e,3),size:n}:t.isPlaneWithPairs(e)?{cardKind:t.PLANE_WITH_PAIRS,val:t.getMaxVal(e,3),size:n}:t.isFourWithTwo(e)?{cardKind:t.FOUR_WITH_TWO,val:t.getMaxVal(e,4),size:n}:t.isFourWithPairs(e)?{cardKind:t.FOUR_WITH_TWO_PAIRS,val:t.getMaxVal(e,4),size:n}:null}},l.prototype.isPairs=function(e){return e.length==2&&e[0].val===e[1].val},l.prototype.isThree=function(e){return e.length==3&&e[0].val===e[1].val&&e[1].val===e[2].val},l.prototype.isThreeWithOne=function(e){if(e.length!=4)return!1;var t=this.valCount(e);return t.length===2&&(t[0].count===3||t[1].count===3)},l.prototype.isThreeWithPairs=function(e){if(e.length!=5)return!1;var t=this.valCount(e);return t.length===2&&(t[0].count===3||t[1].count===3)},l.prototype.isProgression=function(e){if(e.length<5||e[0].val===15)return!1;for(var t=0;t<e.length;t++)if(t!=e.length-1&&e[t].val-1!=e[t+1].val)return!1;return!0},l.prototype.isProgressionPairs=function(e){if(e.length<6||e.length%2!=0||e[0].val===15)return!1;for(var t=0;t<e.length;t+=2)if(t!=e.length-2&&(e[t].val!=e[t+1].val||e[t].val-1!=e[t+2].val))return!1;return!0},l.prototype.isPlane=function(e){if(e.length<6||e.length%3!=0||e[0].val===15)return!1;for(var t=0;t<e.length;t+=3)if(t!=e.length-3&&(e[t].val!=e[t+1].val||e[t].val!=e[t+2].val||e[t].val-1!=e[t+3].val))return!1;return!0},l.prototype.isPlaneWithOne=function(e){if(e.length<8||e.length%4!=0)return!1;var t=this.valCount(e),n=[],r=e.length/4;for(var i=0;i<t.length;i++)t[i].count==3&&n.push(t[i]);if(n.length!=r||n[0].val===15)return!1;for(i=0;i<n.length;i++)if(i!=n.length-1&&n[i].val-1!=n[i+1].val)return!1;return!0},l.prototype.isPlaneWithPairs=function(e){if(e.length<10||e.length%5!=0)return!1;var t=this.valCount(e),n=[],r=[],i=e.length/5;for(var s=0;s<t.length;s++)if(t[s].count==3)n.push(t[s]);else{if(t[s].count!=2)return!1;r.push(t[s])}if(n.length!=i||r.length!=i||n[0].val===15)return!1;for(s=0;s<n.length;s++)if(s!=n.length-1&&n[s].val-1!=n[s+1].val)return!1;return!0},l.prototype.isFourWithTwo=function(e){var t=this.valCount(e);if(e.length!=6||t.length>3)return!1;for(var n=0;n<t.length;n++)if(t[n].count===4)return!0;return!1},l.prototype.isFourWithPairs=function(e){if(e.length!=8)return!1;var t=this.valCount(e);if(t.length!=3)return!1;for(var n=0;n<t.length;n++)if(t[n].count!=4&&t[n].count!=2)return!1;return!0},l.prototype.isBomb=function(e){return e.length===4&&e[0].val===e[1].val&&e[0].val===e[2].val&&e[0].val===e[3].val},l.prototype.isKingBomb=function(e){return e.length===2&&e[0].type=="0"&&e[1].type=="0"},l.prototype.random=function(e,t){e=e==null?0:e,t=t==null?1:t;var n=t-e+1;return Math.floor(Math.random()*n+e)},l.prototype.valCount=function(e){var t=[],n=function(e,t){for(var n=0;n<e.length;n++)if(e[n].val==t){e[n].count++;return}e.push({val:t,count:1})};for(var r=0;r<e.length;r++)n(t,e[r].val);return t},l.prototype.getMaxVal=function(e,t){var n=this.valCount(e),r=0;for(var i=0;i<n.length;i++)n[i].count===t&&n[i].val>r&&(r=n[i].val);return r},l.prototype.ONE=1,l.prototype.PAIRS=2,l.prototype.THREE=3,l.prototype.THREE_WITH_ONE=4,l.prototype.THREE_WITH_PAIRS=5,l.prototype.PROGRESSION=6,l.prototype.PROGRESSION_PAIRS=7,l.prototype.PLANE=8,l.prototype.PLANE_WITH_ONE=9,l.prototype.PLANE_WITH_PAIRS=10,l.prototype.FOUR_WITH_TWO=11,l.prototype.FOUR_WITH_TWO_PAIRS=12,l.prototype.BOMB=13,l.prototype.KING_BOMB=14,l.prototype.MSG_NO_SELECT="请选择要出的牌",l.prototype.MSG_ERROR_TYPE="您选择的牌不符合游戏规则",l.prototype.MSG_NO_ROROB_RESTART="所有玩家均未叫分，重新发牌";var c=qc.landlord.Card=function(){this.data=[{icon:"j1.jpg",type:"0",val:17},{icon:"j2.jpg",type:"0",val:16},{icon:"t1.jpg",type:"1",val:14},{icon:"t2.jpg",type:"1",val:15},{icon:"t3.jpg",type:"1",val:3},{icon:"t4.jpg",type:"1",val:4},{icon:"t5.jpg",type:"1",val:5},{icon:"t6.jpg",type:"1",val:6},{icon:"t7.jpg",type:"1",val:7},{icon:"t8.jpg",type:"1",val:8},{icon:"t9.jpg",type:"1",val:9},{icon:"t10.jpg",type:"1",val:10},{icon:"t11.jpg",type:"1",val:11},{icon:"t12.jpg",type:"1",val:12},{icon:"t13.jpg",type:"1",val:13},{icon:"x1.jpg",type:"2",val:14},{icon:"x2.jpg",type:"2",val:15},{icon:"x3.jpg",type:"2",val:3},{icon:"x4.jpg",type:"2",val:4},{icon:"x5.jpg",type:"2",val:5},{icon:"x6.jpg",type:"2",val:6},{icon:"x7.jpg",type:"2",val:7},{icon:"x8.jpg",type:"2",val:8},{icon:"x9.jpg",type:"2",val:9},{icon:"x10.jpg",type:"2",val:10},{icon:"x11.jpg",type:"2",val:11},{icon:"x12.jpg",type:"2",val:12},{icon:"x13.jpg",type:"2",val:13},{icon:"h1.jpg",type:"3",val:14},{icon:"h2.jpg",type:"3",val:15},{icon:"h3.jpg",type:"3",val:3},{icon:"h4.jpg",type:"3",val:4},{icon:"h5.jpg",type:"3",val:5},{icon:"h6.jpg",type:"3",val:6},{icon:"h7.jpg",type:"3",val:7},{icon:"h8.jpg",type:"3",val:8},{icon:"h9.jpg",type:"3",val:9},{icon:"h10.jpg",type:"3",val:10},{icon:"h11.jpg",type:"3",val:11},{icon:"h12.jpg",type:"3",val:12},{icon:"h13.jpg",type:"3",val:13},{icon:"k1.jpg",type:"4",val:14},{icon:"k2.jpg",type:"4",val:15},{icon:"k3.jpg",type:"4",val:3},{icon:"k4.jpg",type:"4",val:4},{icon:"k5.jpg",type:"4",val:5},{icon:"k6.jpg",type:"4",val:6},{icon:"k7.jpg",type:"4",val:7},{icon:"k8.jpg",type:"4",val:8},{icon:"k9.jpg",type:"4",val:9},{icon:"k10.jpg",type:"4",val:10},{icon:"k11.jpg",type:"4",val:11},{icon:"k12.jpg",type:"4",val:12},{icon:"k13.jpg",type:"4",val:13}]};c.prototype.getNewCards=function(){return this.data.slice(0)};var h=qc.landlord.AICardType=function(e,t){this.val=e,this.cardList=t},p=qc.landlord.AILogic=function(e){this.player=e,this.cards=e.cardList.slice(0),this.analyse()};p.prototype.follow=function(){var t=this,n=e.landlordUI.winCard;t.log();if(n.cardKind!=G.gameRule.BOMB&&n.cardKind!=G.gameRule.KING_BOMB&&(t._bomb.length>0||t._kingBomb.length>0)){var r=e.landlordUI.roundWinner;if(r.isLandlord&&r.cardList.length<5||t.player.isLandlord&&(t.player.cardList.length<5||t.player.nextPlayer.cardList.length<5||t.player.nextPlayer.nextPlayer.cardList.length<6)||t.times()<=3)return t._bomb.length>0?t.minCards(t._bomb,G.gameRule.BOMB):t.setCardKind(t._kingBomb[0],G.gameRule.KING_BOMB)}switch(n.cardKind){case G.gameRule.ONE:var i=t.matchCards(t._one,G.gameRule.ONE);if(!i){if(e.landlordUI.roundWinner.isLandlord||t.player.isLandlord)for(var s=0;s<t.cards.length;s++)if(t.cards[s].val<=15&&t.cards[s].val>n.val)return{cardList:t.cards.slice(s,s+1),cardKind:G.gameRule.ONE,size:1,val:t.cards.slice(s,s+1)[0].val};if(t.times<=1&&t._pairs.length>0&&t._pairs[0].val>10){var o=t.cards.slice(0,1);return o[0].val>n.val?{cardList:o,cardKind:G.gameRule.ONE,size:1,val:o[0].val}:null}}return i;case G.gameRule.PAIRS:var u=t._pairs.length>0?t.matchCards(t._pairs,G.gameRule.PAIRS):null;if(u==null&&(e.landlordUI.roundWinner.isLandlord||t.player.isLandlord))if(t._progressionPairs.length>0)for(var s=t._progressionPairs.length-1;s>=0;s--){if(n.val>=t._progressionPairs[s].val)continue;for(var a=t._progressionPairs[s].cardList.length-1;a>=0;a-=2)if(t._progressionPairs[s].cardList[a].val>n.val){var f=t._progressionPairs[s].cardList.splice(a-1,2);return{cardList:f,cardKind:G.gameRule.PAIRS,size:2,val:f[0].val}}}else if(t._three.length>0)for(var s=t._three.length-1;s>=0;s--)if(t._three[s].val>n.val)return{cardList:t._three[s].cardList.slice(0,2),cardKind:G.gameRule.PAIRS,size:2,val:t._three[s].val};return u;case G.gameRule.THREE:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;return t.matchCards(t._three,G.gameRule.THREE);case G.gameRule.THREE_WITH_ONE:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;var l=t.minCards(t._three,G.gameRule.THREE,n.val);if(l){var i=t.minOne(2,l.val);if(!i)return null;l.cardList.push(i),l.cardKind=G.gameRule.THREE_WITH_ONE,l.size=4}return l;case G.gameRule.THREE_WITH_PAIRS:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;var l=t.minCards(t._three,G.gameRule.THREE,n.val);if(l){var u=t.minCards(t._pairs,G.gameRule.PAIRS);for(;;){if(u.cardList[0].val!==l.val)break;u=t.minCards(t._pairs,G.gameRule.PAIRS,u.cardList[0].val)}if(!u)return null;l.cardList=l.cardList.concat(u.cardList)}return l;case G.gameRule.PROGRESSION:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;if(t._progression.length>0)for(var s=t._progression.length-1;s>=0;s--)if(n.val<t._progression[s].val&&n.size<=t._progression[s].cardList.length){if(n.size===t._progression[s].cardList.length)return t.setCardKind(t._progression[s],G.gameRule.PROGRESSION);if(t.player.isLandlord||e.landlordUI.roundWinner.isLandlord){var c=t._progression[s].val-n.val,h=t._progression[s].cardList.length-n.size;for(var a=0;a<h;a++){if(c>1){t._progression[s].cardList.shift(),c--;continue}t._progression[s].cardList.pop()}return t.setCardKind(t._progression[s],G.gameRule.PROGRESSION)}return null}return null;case G.gameRule.PROGRESSION_PAIRS:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;if(t._progressionPairs.length>0)for(var s=t._progressionPairs.length-1;s>=0;s--)if(n.val<t._progressionPairs[s].val&&n.size<=t._progressionPairs[s].cardList.length){if(n.size===t._progressionPairs[s].cardList.length)return t.setCardKind(t._progressionPairs[s],G.gameRule.PROGRESSION_PAIRS);if(t.player.isLandlord||e.landlordUI.roundWinner.isLandlord){var c=t._progressionPairs[s].val-n.val,h=(t._progressionPairs[s].cardList.length-n.size)/2;for(var a=0;a<h;a++){if(c>1){t._progressionPairs[s].cardList.shift(),t._progressionPairs[s].cardList.shift(),c--;continue}t._progressionPairs[s].cardList.pop(),t._progressionPairs[s].cardList.pop()}return t.setCardKind(t._progressionPairs[s],G.gameRule.PROGRESSION_PAIRS)}return null}return null;case G.gameRule.PLANE:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;return t.minPlane(n.size);case G.gameRule.PLANE_WITH_ONE:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;var p=n.size/4,d=t.minPlane(p*3);if(d){var v=2;for(var s=0;s<p;s++){var i=t.minOne(v,d.val);if(!i)return null;d.cardList.push(i),v=i.val}d.cardKind=G.gameRule.PLANE_WITH_ONE,d.size=d.cardList.length}return d;case G.gameRule.PLANE_WITH_PAIRS:if(!e.landlordUI.roundWinner.isLandlord&&!t.player.isLandlord)return null;var p=n.size/5,d=t.minPlane(p*3);if(d){var m=2;for(var s=0;s<p;s++){var u=t.minCards(t._pairs,G.gameRule.PAIRS,m);if(!u)return null;d.cardList=d.cardList.concat(u.cardList),m=u.val}d.cardKind=G.gameRule.PLANE_WITH_PAIRS,d.size=d.cardList.length}return d;case G.gameRule.BOMB:var r=e.landlordUI.roundWinner;if(!r.isLandlord&&!t.player.isLandlord)return null;var g=t.minCards(t._bomb,G.gameRule.BOMB,n.val);if(g)return g;if(t._kingBomb.length>0)if(r.isLandlord&&r.cardList.length<6||t.player.isLandlord&&t.player.cardList.length<6)return t.setCardKind(t._kingBomb[0],G.gameRule.KING_BOMB);return null;case G.gameRule.FOUR_WITH_TWO:return t.minCards(t._bomb,G.gameRule.BOMB,n.val);case G.gameRule.FOUR_WITH_TWO_PAIRS:return t.minCards(t._bomb,G.gameRule.BOMB,n.val);case G.gameRule.KING_BOMB:return null;default:return null}},p.prototype.play=function(){var t=this;t.log();var n=function(e){var n=t.cards[e];for(var r=0;r<t._one.length;r++)if(t._one[r].val===n.val)return t.minCards(t._one,G.gameRule.ONE);for(r=0;r<t._pairs.length;r++)if(t._pairs[r].val===n.val)return t.minCards(t._pairs,G.gameRule.PAIRS);for(r=0;r<t._three.length;r++)if(t._three[r].val===n.val)return t.minCards(t._three,G.gameRule.THREE);for(r=0;r<t._bomb.length;r++)if(t._bomb[r].val===n.val)return t.minCards(t._bomb,G.gameRule.BOMB);for(r=0;r<t._plane.length;r++)for(var i=0;i<t._plane[r].cardList.length;i++)if(t._plane[r].cardList[i].val===n.val&&t._plane[r].cardList[i].type===n.type)return t.minCards(t._plane,G.gameRule.PLANE);for(r=0;r<t._progression.length;r++)for(var i=0;i<t._progression[r].cardList.length;i++)if(t._progression[r].cardList[i].val===n.val&&t._progression[r].cardList[i].type===n.type)return t.minCards(t._progression,G.gameRule.PROGRESSION);for(r=0;r<t._progressionPairs.length;r++)for(var i=0;i<t._progressionPairs[r].cardList.length;i++)if(t._progressionPairs[r].cardList[i].val===n.val&&t._progressionPairs[r].cardList[i].type===n.type)return t.minCards(t._progressionPairs,G.gameRule.PROGRESSION_PAIRS)};for(var r=t.cards.length-1;r>=0;r--){var i=n(r);if(i.cardKind!==G.gameRule.ONE){if(i.cardKind===G.gameRule.THREE){var f=t.minCards(t._three,G.gameRule.THREE),o=f.cardList.length/3;if(t._one.length>=0){var a=t.minOne(u,f.val);return f.cardList.push(a),t.setCardKind(f,G.gameRule.THREE_WITH_ONE)}if(t._pairs.length>0){var l=t.minCards(t._pairs,G.gameRule.PAIRS,c);return f.cardList=f.cardList.concat(l.cardList),t.setCardKind(f,G.gameRule.THREE_WITH_PAIRS)}return t.setCardKind(f,G.gameRule.THREE)}if(i.cardKind===G.gameRule.PLANE){var s=t.minCards(t._plane,G.gameRule.PLANE),o=s.cardList.length/3;if(t._one.length>o&&t._pairs.length>o){if(t._one.length>=t._pairs.length){var u=2;for(var r=0;r<o;r++){var a=t.minOne(u,s.val);s.cardList.push(a),u=a.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_ONE)}var c=2;for(var r=0;r<o;r++){var l=t.minCards(t._pairs,G.gameRule.PAIRS,c);s.cardList=s.cardList.concat(l.cardList),c=l.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_PAIRS)}if(t._pairs.length>o){var c=2;for(var r=0;r<o;r++){var l=t.minCards(t._pairs,G.gameRule.PAIRS,c);s.cardList=s.cardList.concat(l.cardList),c=l.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_PAIRS)}if(t._one.length>o){var u=2;for(var r=0;r<o;r++){var a=t.minOne(u,s.val);s.cardList.push(a),u=a.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_ONE)}return t.setCardKind(s,G.gameRule.PLANE)}if(i.cardKind===G.gameRule.BOMB&&t.times()===1)return i;if(i.cardKind===G.gameRule.BOMB&&t.times()!=1)continue;return i}if(t._plane.length>0){var s=t.minCards(t._plane,G.gameRule.PLANE),o=s.cardList.length/3,u=2;for(var r=0;r<o;r++){var a=t.minOne(u,s.val);s.cardList.push(a),u=a.val}return t.setCardKind(s,G.gameRule.PLANE_WITH_ONE)}if(t._three.length>0){var f=t.minCards(t._three,G.gameRule.THREE),o=f.cardList.length/3,a=t.minOne(u,f.val);f.cardList.push(a);if(f.val<14)return t.setCardKind(f,G.gameRule.THREE_WITH_ONE)}if(!t.player.isLandlord)return e.playUI.currentLandlord.cardList.length<=2?t.playOneAtTheEnd():t.minCards(t._one,G.gameRule.ONE);if(t.player.isLandlord)return t.player.nextPlayer.cardList.length<=2||t.player.nextPlayer.nextPlayer.cardList.length<=2?t.playOneAtTheEnd():t.minCards(t._one,G.gameRule.ONE)}},p.prototype.playOneAtTheEnd=function(){var t=this;if(t._progression.length>0)return t.minCards(t._progression,G.gameRule.PROGRESSION);if(t._plane.length>0){var n=t.minCards(t._plane,G.gameRule.PLANE),r=n.cardList.length/3;if(t._one.length>r&&t._pairs.length>r){if(t._one.length>=t._pairs.length){var i=2;for(var s=0;s<r;s++){var o=t.minOne(i,n.val);n.cardList.push(o),i=o.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_ONE)}var u=2;for(var s=0;s<r;s++){var a=t.minCards(t._pairs,G.gameRule.PAIRS,u);n.cardList=n.cardList.concat(a.cardList),u=a.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_PAIRS)}if(t._pairs.length>r){var u=2;for(var s=0;s<r;s++){var a=t.minCards(t._pairs,G.gameRule.PAIRS,u);n.cardList=n.cardList.concat(a.cardList),u=a.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_PAIRS)}if(t._one.length>r){var i=2;for(var s=0;s<r;s++){var o=t.minOne(i,n.val);n.cardList.push(o),i=o.val}return t.setCardKind(n,G.gameRule.PLANE_WITH_ONE)}return t.setCardKind(n,G.gameRule.PLANE)}if(t._progressionPairs.length>0)return t.minCards(t._progressionPairs,G.gameRule.PROGRESSION_PAIRS);if(t._three.length>0){var f=t.minCards(t._three,G.gameRule.THREE),r=f.cardList.length/3;if(t._one.length>=0){var o=t.minOne(i,f.val);return f.cardList.push(o),t.setCardKind(f,G.gameRule.THREE_WITH_ONE)}if(t._pairs.length>0){var a=t.minCards(t._pairs,G.gameRule.PAIRS,u);return f.cardList=f.cardList.concat(a.cardList),t.setCardKind(f,G.gameRule.THREE_WITH_PAIRS)}return t.setCardKind(f,G.gameRule.THREE)}if(t._pairs.length>0)return t.player.isLandlord&&(t.player.nextPlayer.cardList.length===2||t.player.nextPlayer.nextPlayer.cardList.length===2)||!t.player.isLandlord&&e.playUI.currentLandlord.cardList.length===2?t.maxCards(t._pairs,G.gameRule.PAIRS):t.minCards(t._pairs,G.gameRule.PAIRS);if(t._one.length>0)return t.player.isLandlord&&(t.player.nextPlayer.cardList.length<=2||t.player.nextPlayer.nextPlayer.cardList.length<=2)||!t.player.isLandlord&&e.playUI.currentLandlord.cardList.length<=2?t.maxCards(t._one,G.gameRule.ONE):t.minCards(t._one,G.gameRule.ONE);var o=null;return t.player.isLandlord&&(t.player.nextPlayer.cardList.length<=2||t.player.nextPlayer.nextPlayer.cardList.length<=2)||!t.player.isLandlord&&e.playUI.currentLandlord.cardList.length<=2?o=t.cards.slice(t.cards.length-1,t.cards.length):o=t.cards.slice(0,1),{size:1,cardKind:G.gameRule.ONE,cardList:o,val:o[0].val}},p.prototype.getMinVal=function(e,t){var n=this,r=G.gameRule.valCount(n.cards);for(var i=r.length-1;i>=0;i--)if(r[i].count===e&&r[i].val>t)return n.cards.splice(i,1)},p.prototype.analyse=function(){var t=this,n=t.cards.slice(0),r=null,i=null,s=null,o=null,u=null;t._one=[],t._pairs=[],t._kingBomb=[],t._bomb=[],t._three=[],t._plane=[],t._progression=[],t._progressionPairs=[],n.sort(t.cardSort),G.gameRule.isKingBomb(n.slice(0,2))&&t._kingBomb.push(new qc.landlord.AICardType(17,n.splice(0,2))),r=G.gameRule.valCount(n);for(var a=0;a<r.length;a++)if(r[a].count===4){var f=[];t.moveItem(n,f,r[a].val),t._bomb.push(new qc.landlord.AICardType(f[0].val,f))}i=n.slice(0),s=i.slice(0),t.judgeThree(s),t.judgePlane();for(a=0;a<t._three.length;a++)s=s.concat(t._three[a].cardList);t._three=[],s.sort(e.playUI.cardSort),o=s.slice(0),t.judgeProgression(o),t.judgeProgressionPairs(o),t.judgeThree(o),r=G.gameRule.valCount(o);for(a=0;a<r.length;a++)if(r[a].count===1)for(var l=0;l<o.length;l++)o[l].val===r[a].val&&t._one.push(new qc.landlord.AICardType(r[a].val,o.splice(l,1)));else if(r[a].count===2)for(var l=0;l<o.length;l++)o[l].val===r[a].val&&t._pairs.push(new qc.landlord.AICardType(r[a].val,o.splice(l,2)))},p.prototype.judgeThree=function(e){var t=this,n=G.gameRule.valCount(e);for(i=0;i<n.length;i++)if(n[i].count===3){var r=[];t.moveItem(e,r,n[i].val),t._three.push(new qc.landlord.AICardType(r[0].val,r))}},p.prototype.judgePlane=function(){var e=this;if(e._three.length>1){var t=[];for(i=0;i<e._three.length;i++){if(e._three[i].val>=15)continue;if(t.length==0){t.push({obj:e._three[i],fromIndex:i});continue}if(t[t.length-1].val-1==e._three[i].val)t.push({obj:e._three[i],fromIndex:i});else{if(t.length>1){var n=[];for(var r=0;r<t.length;r++)n=n.concat(t[r].obj.cardList);e._plane.push(new qc.landlord.AICardType(t[0].obj.val,n));for(var s=t.length-1;s>=0;s--)e._three.splice(t[s].fromIndex,1)}t=[],t.push({obj:e._three[i],fromIndex:i})}}if(t.length>1){var n=[];for(var r=0;r<t.length;r++)n=n.concat(t[r].obj.cardList);e._plane.push(new qc.landlord.AICardType(t[0].obj.val,n));for(var s=t.length-1;s>=0;s--)e._three.splice(t[s].fromIndex,1)}}},p.prototype.judgeProgression=function(e){var t=this,n=function(n){var r=[];for(var i=0;i<n.length;i++)r.push(n[i].obj);t._progression.push(new qc.landlord.AICardType(n[0].obj.val,r));for(var s=n.length-1;s>=0;s--)e.splice(n[s].fromIndex,1)};if(e.length>=5){var r=[];for(var i=0;i<e.length;i++){if(e[i].val>=15)continue;if(r.length==0){r.push({obj:e[i],fromIndex:i});continue}if(r[r.length-1].obj.val-1===e[i].val){r.push({obj:e[i],fromIndex:i});if(r.length===5)break}else{if(r[r.length-1].obj.val===e[i].val)continue;if(r.length>=5)break;r=[],r.push({obj:e[i],fromIndex:i})}}r.length===5?(n(r),t.judgeProgression(e)):t.joinProgression(e)}},p.prototype.joinProgression=function(e){var t=this;for(var n=0;n<t._progression.length;n++)for(var r=0;r<e.length;r++)t._progression[n].val!=14&&t._progression[n].val===e[r].val-1?t._progression[n].cardList.unshift(e.splice(r,1)[0]):e[r].val===t._progression[n].val-t._progression[n].cardList.length&&t._progression[n].cardList.push(e.splice(r,1)[0]);var i=t._progression.slice(0);for(n=0;n<i.length;n++)n<i.length-1&&i[n].val-i[n].cardList.length===i[n+1].val&&(t._progression[n].cardList=t._progression[n].cardList.concat(t._progression[n+1].cardList),t._progression.splice(++n,1))},p.prototype.judgeProgressionPairs=function(t){var n=this,r=function(r){var i=[];for(var s=r.length-1;s>=0;s--)for(var o=0;o<t.length;o++)if(t[o].val===r[s]){i=i.concat(t.splice(o,2));break}i.sort(e.playUI.cardSort),n._progressionPairs.push(new qc.landlord.AICardType(r[0],i))};if(t.length>=6){var i=[],s=G.gameRule.valCount(t);for(var o=0;o<s.length;o++){if(s[o].val>=15)continue;if(i.length==0&&s[o].count>=2){i.push(s[o].val);continue}if(i[i.length-1]-1===s[o].val&&s[o].count>=2)i.push(s[o].val);else{if(i.length>=3)break;i=[],s[o].count>=2&&i.push(s[o].val)}}i.length>=3&&(r(i),n.judgeProgressionPairs(t))}},p.prototype.moveItem=function(e,t,n){for(var r=e.length-1;r>=0;r--)e[r].val===n&&t.push(e.splice(r,1)[0])},p.prototype.cardSort=function(e,t){var n=parseInt(e.val),r=parseInt(t.val);return n===r?e.type>t.type?1:-1:n>r?-1:1},p.prototype.setCardKind=function(e,t){return e.cardKind=t,e.size=e.cardList.length,e},p.prototype.minPlane=function(t){var n=this,r=e.landlordUI.winCard;if(n._plane.length>0)for(var i=n._plane.length-1;i>=0;i--)if(r.val<n._plane[i].val&&t<=n._plane[i].cardList.length){if(t===n._plane[i].cardList.length)return n.setCardKind(n._plane[i],G.gameRule.PLANE);var s=n._plane[i].val-r.val,o=(n._plane[i].cardList.length-t)/3;for(var u=0;u<o;u++){if(s>1){for(var a=0;a<3;a++)n._plane[i].cardList.shift();s--;continue}for(var a=0;a<3;a++)n._plane[i].cardList.pop()}return n.setCardKind(n._plane[i],G.gameRule.PLANE)}return null},p.prototype.minCards=function(e,t,n){var r=this;n=n?n:2;if(e.length>0)for(var i=e.length-1;i>=0;i--)if(n<e[i].val)return r.setCardKind(e[i],t);return null},p.prototype.maxCards=function(e,t,n){var r=this,i=null;if(e.length>0){for(var s=0;s<e.length;s++)if(i&&e[s].val>i.val||!i)i=e[s];return n?i.val>n?r.setCardKind(i,t):null:r.setCardKind(i,t)}return null},p.prototype.matchCards=function(t,n){var r=this,i=e.landlordUI.winCard,s=e.landlordUI.roundWinner;if(r.player.isLandlord)return r.player.nextPlayer.cardList.length<3||r.player.nextPlayer.nextPlayer.cardList.length<3?r.maxCards(t,n,i.val):r.minCards(t,n,i.val);if(s.isLandlord)return s.cardList.length<3?r.maxCards(t,n,i.val):r.minCards(t,n,i.val);var o=r.minCards(t,n,i.val);return o?o.val<14?o:null:null},p.prototype.minOne=function(e,t){var n=this,r=n.minCards(n._one,G.gameRule.ONE,e),i=n.offPairs(t);return r?r.val>14?i?(n.deleteOne(i),i):null:r.cardList[0]:i?(n.deleteOne(i),i):null},p.prototype.offPairs=function(e,t){var n=this,r=n.minCards(n._pairs,G.gameRule.PAIRS,e);if(r)for(;;){if(r.cardList[0].val!==t)break;r=n.minCards(n._pairs,G.gameRule.PAIRS,r.cardList[0].val)}return r?r.cardList[0]:null},p.prototype.deleteOne=function(e){for(var t=0;t<this.cards.length;t++)this.cards[t].val===e.val&&this.cards[t].type===e.type&&this.cards.splice(t,1);this.analyse()},p.prototype.judgeScore=function(){var e=this,t=0;t+=e._bomb.length*6,e._kingBomb.length>0?t+=8:e.cards[0].val===17?t+=4:e.cards[0].val===16&&(t+=3);for(var n=0;n<e.cards.length;n++)e.cards[n].val===15&&(t+=2);return console.info(e.player.name+"手牌评分："+t),t>=7?3:t>=5?2:t>=3?1:4},p.prototype.times=function(){var e=this,t=this._kingBomb.length+this._bomb.length+this._progression.length+this._progressionPairs.length+this._one.length+this._pairs.length,n=this._three.length;if(this._plane.length>0)for(var r=0;r<this._plane.length;r++)n+=this._plane[r].cardList.length/3;return n-(this._one.length+this._pairs.length)>0&&(t+=n-(this._one.length+this._pairs.length)),t},p.prototype.log=function(){var e=this;console.info("以下显示【"+e.player.name+"】手牌概况，手数："+e.times()),console.info("王炸"),console.info(e._kingBomb),console.info("炸弹"),console.info(e._bomb),console.info("三根"),console.info(e._three),console.info("飞机"),console.info(e._plane),console.info("顺子"),console.info(e._progression),console.info("连对"),console.info(e._progressionPairs),console.info("单牌"),console.info(e._one),console.info("对子"),console.info(e._pairs)}}).call(this,this,Object)